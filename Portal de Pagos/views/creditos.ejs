<%- include('partials/head.ejs', {
    isLoggedIn: isLoggedIn, 
    permisos: permisos,
    usuario: usuario
  }) %>


<br>

<div class='grid-container'>    
    <div class='col s6 card grid-item grid-item-1 responsibe-table'>
        <table class='striped centered responsibe-table'>
            <thead>
                <tr>
                    <th style='font-size: 18px;' colspan='2'>Historial del Valor de Creditos Pasados</th>
                </tr>

                <tr>
                    <th>Ciclo Escolar</th>
                    <th>Costo</th>
                </tr>
            </thead>

            <tbody>
                <% cicloescolar.forEach(function(cicloescolar) { %>
                    <tr>
                        <td><%= cicloescolar.MesInicio%> - <%= cicloescolar.MesFin%> <%= cicloescolar.Año%></td>
                        <td><%= cicloescolar.CostoCreditos%></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>

    <div class='col s4'>
        <div class='card'>
            <div class='grid-item grid-item-2 responsibe-table'>
                    <span class='card-title'><strong>Registrar valor de credito nuevo</strong></span>
                <form action='/creditos' method='POST'>
                    <div class='row'>
                        <div class='col s10 offset-s1 input-field'>
                            <input id='MesInicio' name='MesInicio' type='hidden' required='' autocomplete='off' class='validate'>
                            <input id='MesFin' name='MesFin' type='hidden' required='' autocomplete='off' class='validate'>
                            <label for='MesInicio'></label>
                            <label for='MesFin'></label>
                            <select id='selectMesInicio' class='browser-default'>
                                <option value='' disabled selected>Selecciona el Ciclo Escolar:</option>
                                <option value='Enero-Julio'>Enero-Julio</option>
                                <option value='Agosto-Diciembre'>Agosto-Diciembre</option>
                            </select>
                        </div>
                    </div>
                    <div class='row'>
                        <div class='col s10 offset-s1 input-field'>
                            <input id='Año' name='Año' type='number' required='' autocomplete='off' class='validate'>
                            <label for='Año'>Año</label>
                        </div>
                    </div>

                    <div class='row'>
                        <div class='col s10 offset-s1 input-field'>
                            <input id='CostoCreditos' name='CostoCreditos' type='number' required='' autocomplete='off' class='validate'>
                            <label for='CostoCreditos'>Nuevo valor del credito</label>
                        </div>
                    </div>

                    <div class='row'>
                        <div class='col 8 offset-s2'>
                            <button id='CreditoNuevo' class='btn waves-effect waves-light carmin' type='submit'>Registrar nuevo valor de credito</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    document.getElementById('selectMesInicio').addEventListener('change', function() {
        const selectedValue = this.value;
        const mesInicioInput = document.getElementById('MesInicio');
        const mesFinInput = document.getElementById('MesFin');

        if (selectedValue === 'Enero-Julio') {
            mesInicioInput.value = 'Enero';
            mesFinInput.value = 'Julio';
        } else if (selectedValue === 'Agosto-Diciembre') {
            mesInicioInput.value = 'Agosto';
            mesFinInput.value = 'Diciembre';
        }
    });
</script>

<script src='https://cdn.jsdelivr.net/npm/sweetalert2@10'></script>
<script>
    $(document).ready( function () {
    
        $('#CreditoNuevo').click(function(e) {
            e.preventDefault(); // Prevent the form from automatically submitting
    
            let nuevoValor = $('#CostoCreditos').val();
            let cicloEscolar1 = $('#MesInicio').val();
            let cicloEscolar2 = $('#MesFin').val();
            let año = $('#Año').val();
    
            if (nuevoValor == '' || cicloEscolar1 == '' || cicloEscolar2 == '' || año == '') {
                Swal.fire({
                    html: '<b>Por favor, completa todos los campos</b>',
                    confirmButtonColor: '#d33',
                    confirmButtonText: 'OK'
                });
                return false;
            }
    
            // If the new value is valid, submit the form
            Swal.fire({
                html: `¿Quieres registrar el nuevo valor de crédito $<b>${nuevoValor}</b> para el ciclo escolar <b>${cicloEscolar1}-${cicloEscolar2} ${año}</b>?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, registrar nuevo valor',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title:'Valor de credito registrado!',
                text:'El valor de credito ha sido registrado exitosamente',
                icon:'success',
                timer: 2000,
                timerProgressBar: true,
                onClose: () => {
                    $('form').submit();
                }
            });
        }
        });
    });
});
    </script>

<%- include('partials/footer.ejs') %>